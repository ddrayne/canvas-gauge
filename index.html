<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Classic Performance Gauge Cluster</title>
  <meta name="description" content="Hyper-realistic car gauge cluster demo with physics-based needle animation">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Oswald:wght@300;400;500&family=Bebas+Neue&display=swap');

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg-dark: #0a0a0c;
      --bg-panel: #121216;
      --surface: #1a1a1f;
      --surface-elevated: #242429;
      --text-primary: #f5f5f7;
      --text-secondary: #8e8e93;
      --accent: #ff3b30;
      --accent-glow: rgba(255, 59, 48, 0.3);
      --border: rgba(255, 255, 255, 0.08);
    }

    html, body {
      height: 100%;
      font-family: 'Oswald', system-ui, sans-serif;
      background: var(--bg-dark);
      color: var(--text-primary);
      overflow-x: hidden;
    }

    body {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      background:
        radial-gradient(ellipse at 50% 0%, rgba(40, 40, 50, 0.4) 0%, transparent 60%),
        linear-gradient(180deg, var(--bg-dark) 0%, #050507 100%);
    }

    /* Header */
    header {
      padding: 24px 32px 0;
      text-align: center;
      border-bottom: 1px solid var(--border);
    }

    .page-nav {
      display: flex;
      justify-content: center;
      gap: 32px;
      padding: 16px 0;
    }

    .nav-link {
      font-family: 'Oswald', sans-serif;
      font-size: 14px;
      font-weight: 500;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: var(--text-secondary);
      text-decoration: none;
      padding: 4px 0;
      border-bottom: 2px solid transparent;
      transition: all 0.2s;
    }

    .nav-link:hover { color: var(--text-primary); }
    .nav-link.active {
      color: var(--accent);
      border-bottom-color: var(--accent);
    }

    h1 {
      font-family: 'Bebas Neue', 'Oswald', sans-serif;
      font-size: clamp(28px, 5vw, 48px);
      font-weight: 400;
      letter-spacing: 4px;
      text-transform: uppercase;
      background: linear-gradient(135deg, #fff 0%, #b0b0b0 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .subtitle {
      font-size: 13px;
      font-weight: 300;
      letter-spacing: 2px;
      color: var(--text-secondary);
      margin-top: 4px;
      text-transform: uppercase;
    }

    /* Main content */
    main {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 32px 16px;
      gap: 32px;
    }

    /* Gauge cluster container */
    .gauge-container {
      width: 100%;
      max-width: 800px;
      filter: drop-shadow(0 30px 60px rgba(0, 0, 0, 0.6));
    }

    /* Cluster layout (moved from CarGaugeCluster shadow DOM) */
    .cluster {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      padding: 24px;
      background: linear-gradient(145deg, #1a1a1a 0%, #0d0d0d 100%);
      border-radius: 16px;
      box-shadow:
        0 20px 60px rgba(0, 0, 0, 0.5),
        inset 0 1px 0 rgba(255, 255, 255, 0.05);
      width: 100%;
      max-width: 900px;
      margin: 0 auto;
    }

    .large-gauge {
      aspect-ratio: 1;
      max-width: 100%;
    }

    .small-gauges {
      grid-column: 1 / -1;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
    }

    .small-gauge {
      aspect-ratio: 1;
    }

    @media (max-width: 600px) {
      .cluster {
        grid-template-columns: 1fr;
        padding: 16px;
      }

      .small-gauges {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    /* Control panel */
    .controls {
      width: 100%;
      max-width: 900px;
      background: var(--surface);
      border-radius: 16px;
      padding: 24px;
      border: 1px solid var(--border);
      box-shadow:
        0 8px 32px rgba(0, 0, 0, 0.4),
        inset 0 1px 0 rgba(255, 255, 255, 0.04);
    }

    .control-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
    }

    .control-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .control-label {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      font-size: 12px;
      font-weight: 500;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      color: var(--text-secondary);
    }

    .control-value {
      font-family: 'Oswald', monospace;
      font-size: 14px;
      color: var(--text-primary);
      min-width: 50px;
      text-align: right;
    }

    /* Slider styling */
    input[type="range"] {
      -webkit-appearance: none;
      appearance: none;
      width: 100%;
      height: 6px;
      background: var(--bg-dark);
      border-radius: 3px;
      outline: none;
      cursor: pointer;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 18px;
      height: 18px;
      background: linear-gradient(145deg, #fff 0%, #c0c0c0 100%);
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
      transition: transform 0.15s ease;
    }

    input[type="range"]::-webkit-slider-thumb:hover {
      transform: scale(1.1);
    }

    input[type="range"]::-moz-range-thumb {
      width: 18px;
      height: 18px;
      background: linear-gradient(145deg, #fff 0%, #c0c0c0 100%);
      border-radius: 50%;
      cursor: pointer;
      border: none;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
    }

    /* Buttons */
    .button-row {
      display: flex;
      gap: 12px;
      margin-top: 24px;
      flex-wrap: wrap;
      justify-content: center;
    }

    button {
      font-family: 'Oswald', system-ui, sans-serif;
      font-size: 14px;
      font-weight: 500;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      padding: 12px 28px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--accent) 0%, #cc2020 100%);
      color: white;
      box-shadow: 0 4px 16px var(--accent-glow);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 24px var(--accent-glow);
    }

    .btn-primary:active {
      transform: translateY(0);
    }

    .btn-secondary {
      background: var(--surface-elevated);
      color: var(--text-primary);
      border: 1px solid var(--border);
    }

    .btn-secondary:hover {
      background: #2a2a30;
    }

    .btn-secondary.active {
      background: linear-gradient(135deg, #2a6b2a 0%, #1f4f1f 100%);
      border-color: #3a8b3a;
    }

    /* Status indicator */
    .status {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
      color: var(--text-secondary);
      letter-spacing: 1px;
      text-transform: uppercase;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #666;
      transition: all 0.3s ease;
    }

    .status-dot.active {
      background: #4cd964;
      box-shadow: 0 0 12px rgba(76, 217, 100, 0.5);
    }

    .reduced-motion-notice {
      display: none;
      align-items: center;
      gap: 8px;
      font-size: 12px;
      color: #f5a623;
      letter-spacing: 1px;
      text-transform: uppercase;
    }

    .reduced-motion-notice.visible {
      display: flex;
    }

    .reduced-motion-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #f5a623;
      box-shadow: 0 0 8px rgba(245, 166, 35, 0.4);
    }

    /* Footer */
    footer {
      padding: 16px;
      text-align: center;
      font-size: 11px;
      color: var(--text-secondary);
      letter-spacing: 1px;
      border-top: 1px solid var(--border);
    }

    footer a {
      color: var(--text-secondary);
      text-decoration: none;
      transition: color 0.2s;
    }

    footer a:hover {
      color: var(--text-primary);
    }

    /* Responsive adjustments */
    @media (max-width: 600px) {
      header {
        padding: 16px;
      }

      main {
        padding: 16px 12px;
      }

      .controls {
        padding: 16px;
      }

      .control-grid {
        grid-template-columns: 1fr 1fr;
        gap: 16px;
      }

      .button-row {
        flex-direction: column;
      }

      button {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>Classic Performance Cluster</h1>
    <p class="subtitle">Canvas 2D â€¢ Spring-Damper Physics â€¢ Pure JS Library</p>
    <nav class="page-nav">
      <a href="index.html" class="nav-link active">Demo</a>
      <a href="docs.html" class="nav-link">Docs</a>
      <a href="builder.html" class="nav-link">Builder</a>
    </nav>
  </header>

  <main>
    <div class="gauge-container">
      <div class="cluster">
        <div class="large-gauge" id="gauge-speed"></div>
        <div class="large-gauge" id="gauge-rpm"></div>

        <div class="small-gauges">
          <div class="small-gauge" id="gauge-volt"></div>
          <div class="small-gauge" id="gauge-temp"></div>
          <div class="small-gauge" id="gauge-oilPressure"></div>
          <div class="small-gauge" id="gauge-oilLevel"></div>
        </div>
      </div>
    </div>

    <div class="controls">
      <div class="control-grid">
        <div class="control-group">
          <div class="control-label">
            <span>Speed</span>
            <span class="control-value" id="speed-value">0 MPH</span>
          </div>
          <input type="range" id="speed-slider" min="0" max="140" value="0">
        </div>

        <div class="control-group">
          <div class="control-label">
            <span>RPM</span>
            <span class="control-value" id="rpm-value">0</span>
          </div>
          <input type="range" id="rpm-slider" min="0" max="80" value="0">
        </div>

        <div class="control-group">
          <div class="control-label">
            <span>Voltage</span>
            <span class="control-value" id="volt-value">12.0 V</span>
          </div>
          <input type="range" id="volt-slider" min="8" max="16" step="0.1" value="12">
        </div>

        <div class="control-group">
          <div class="control-label">
            <span>Temperature</span>
            <span class="control-value" id="temp-value">180Â°F</span>
          </div>
          <input type="range" id="temp-slider" min="100" max="250" value="180">
        </div>

        <div class="control-group">
          <div class="control-label">
            <span>Oil Pressure</span>
            <span class="control-value" id="oil-pressure-value">40 PSI</span>
          </div>
          <input type="range" id="oil-pressure-slider" min="0" max="80" value="40">
        </div>

        <div class="control-group">
          <div class="control-label">
            <span>Oil Level</span>
            <span class="control-value" id="oil-level-value">75%</span>
          </div>
          <input type="range" id="oil-level-slider" min="0" max="1" step="0.01" value="0.75">
        </div>
      </div>

      <div class="button-row">
        <button class="btn-primary" id="sweep-btn">ğŸ”„ Sweep Test</button>
        <button class="btn-secondary" id="drive-btn">ğŸš— Random Drive</button>
        <button class="btn-secondary" id="limiter-btn">ğŸ’¥ Rev Limiter</button>
        <button class="btn-secondary" id="stop-btn">â¹ Stop</button>
      </div>

      <div class="button-row">
        <div class="status">
          <span class="status-dot" id="status-dot"></span>
          <span id="status-text">Ready</span>
        </div>
        <div class="reduced-motion-notice" id="reduced-motion-notice">
          <span class="reduced-motion-dot"></span>
          <span>Reduced motion â€” animations simplified (OS setting)</span>
        </div>
      </div>
    </div>

    <!-- Modern Gauge Demo -->
    <h2 style="font-family: 'Bebas Neue', 'Oswald', sans-serif; font-size: clamp(22px, 4vw, 36px); letter-spacing: 3px; text-transform: uppercase; color: var(--text-secondary); text-align: center;">Modern Digital Cluster</h2>
    <p style="font-size: 12px; color: var(--text-secondary); letter-spacing: 1px; text-transform: uppercase; text-align: center; margin-top: -16px;">Progress Arc â€¢ Ring Indicators â€¢ Complications â€¢ Digital Display</p>

    <div class="gauge-container">
      <div style="display: flex; justify-content: center; padding: 24px; background: linear-gradient(145deg, #1a1a1a 0%, #0d0d0d 100%); border-radius: 16px; box-shadow: 0 20px 60px rgba(0,0,0,0.5), inset 0 1px 0 rgba(255,255,255,0.05);">
        <div id="gauge-modern" style="width: 400px; height: 400px; max-width: 90vw; aspect-ratio: 1;"></div>
      </div>
    </div>

    <div class="controls">
      <div class="control-grid">
        <div class="control-group">
          <div class="control-label">
            <span>Speed</span>
            <span class="control-value" id="modern-speed-value">95 km/h</span>
          </div>
          <input type="range" id="modern-speed-slider" min="0" max="320" value="95">
        </div>
        <div class="control-group">
          <div class="control-label">
            <span>RPM (Ring)</span>
            <span class="control-value" id="modern-rpm-value">3500</span>
          </div>
          <input type="range" id="modern-rpm-slider" min="0" max="8000" value="3500">
        </div>
        <div class="control-group">
          <div class="control-label">
            <span>Fuel Level</span>
            <span class="control-value" id="modern-fuel-value">60%</span>
          </div>
          <input type="range" id="modern-fuel-slider" min="0" max="1" step="0.01" value="0.6">
        </div>
      </div>
      <div class="button-row">
        <button class="btn-primary" id="modern-sweep-btn">Sweep Test</button>
        <button class="btn-secondary" id="modern-drive-btn">Simulated Drive</button>
        <button class="btn-secondary" id="modern-redline-btn">Redline Flash</button>
      </div>
    </div>
  </main>

  <footer>
    <p>Built with pure JS â€¢ No external dependencies â€¢
      <a href="https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API" target="_blank">Canvas 2D API</a>
    </p>
  </footer>

  <script type="module">
    import { Gauge } from './src/index.js';

    // Create all gauges
    const gauges = {
      speed: new Gauge(document.getElementById('gauge-speed'), 'speed'),
      rpm: new Gauge(document.getElementById('gauge-rpm'), 'rpm'),
      volt: new Gauge(document.getElementById('gauge-volt'), 'volt'),
      temp: new Gauge(document.getElementById('gauge-temp'), 'temp'),
      oilPressure: new Gauge(document.getElementById('gauge-oilPressure'), 'oilPressure'),
      oilLevel: new Gauge(document.getElementById('gauge-oilLevel'), 'oilLevel'),
    };

    // Set initial values (snap, no animation)
    gauges.speed.setValue(0, { immediate: true });
    gauges.rpm.setValue(0, { immediate: true });
    gauges.volt.setValue(12, { immediate: true });
    gauges.temp.setValue(180, { immediate: true });
    gauges.oilPressure.setValue(40, { immediate: true });
    gauges.oilLevel.setValue(0.75, { immediate: true });

    // DOM References
    const statusDot = document.getElementById('status-dot');
    const statusText = document.getElementById('status-text');

    // Slider controls
    const sliders = {
      speed: { slider: document.getElementById('speed-slider'), value: document.getElementById('speed-value'), format: v => `${Math.round(v)} MPH` },
      rpm: { slider: document.getElementById('rpm-slider'), value: document.getElementById('rpm-value'), format: v => `${Math.round(v)}00` },
      volt: { slider: document.getElementById('volt-slider'), value: document.getElementById('volt-value'), format: v => `${v.toFixed(1)} V` },
      temp: { slider: document.getElementById('temp-slider'), value: document.getElementById('temp-value'), format: v => `${Math.round(v)}Â°F` },
      oilPressure: { slider: document.getElementById('oil-pressure-slider'), value: document.getElementById('oil-pressure-value'), format: v => `${Math.round(v)} PSI` },
      oilLevel: { slider: document.getElementById('oil-level-slider'), value: document.getElementById('oil-level-value'), format: v => `${Math.round(v * 100)}%` }
    };

    // Button references
    const sweepBtn = document.getElementById('sweep-btn');
    const driveBtn = document.getElementById('drive-btn');
    const limiterBtn = document.getElementById('limiter-btn');
    const stopBtn = document.getElementById('stop-btn');

    // Simulation state
    let simulationActive = false;
    let simulationLoop = null;
    let limiterInterval = null;

    // Bind sliders
    for (const [type, control] of Object.entries(sliders)) {
      control.slider.addEventListener('input', () => {
        const value = parseFloat(control.slider.value);
        gauges[type].setValue(value);
        control.value.textContent = control.format(value);
      });
    }

    // Sweep button â€” stagger for dramatic effect
    sweepBtn.addEventListener('click', () => {
      const gaugeList = Object.values(gauges);
      gaugeList.forEach((gauge, index) => {
        setTimeout(() => gauge.sweep(), index * 100);
      });
      setStatus('Sweep Test', true);
      setTimeout(() => setStatus('Ready', false), 2500);
    });

    // Random drive button
    driveBtn.addEventListener('click', () => {
      if (simulationActive) return;
      startSimulation();
    });

    // Rev limiter button
    limiterBtn.addEventListener('click', () => {
      if (limiterInterval) {
        stopLimiter();
        return;
      }
      stopSimulation();
      const max = 80;
      const drop = max * 0.06;
      gauges.rpm.setValue(max);
      limiterInterval = setInterval(() => {
        gauges.rpm.setValue(max - drop + Math.random() * drop);
        updateSliderDisplay('rpm', max - drop / 2);
      }, 80);
      limiterBtn.classList.add('active');
      setStatus('Rev Limiter', true);
    });

    function stopLimiter() {
      if (limiterInterval) {
        clearInterval(limiterInterval);
        limiterInterval = null;
      }
      limiterBtn.classList.remove('active');
    }

    // Stop button
    stopBtn.addEventListener('click', () => {
      stopLimiter();
      stopSimulation();
    });

    // Reduced motion indicator
    const motionQuery = window.matchMedia('(prefers-reduced-motion: reduce)');
    const motionNotice = document.getElementById('reduced-motion-notice');
    function updateMotionNotice(matches) {
      motionNotice.classList.toggle('visible', matches);
    }
    updateMotionNotice(motionQuery.matches);
    motionQuery.addEventListener('change', (e) => updateMotionNotice(e.matches));

    // Initial sweep on load
    setTimeout(() => {
      const gaugeList = Object.values(gauges);
      gaugeList.forEach((gauge, index) => {
        setTimeout(() => gauge.sweep(), index * 100);
      });
      setStatus('Startup Self-Test', true);
      setTimeout(() => setStatus('Ready', false), 2500);
    }, 500);

    // Status indicator
    function setStatus(text, active) {
      statusText.textContent = text;
      statusDot.classList.toggle('active', active);
      driveBtn.classList.toggle('active', simulationActive);
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // TELEMETRY SIMULATION
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    function startSimulation() {
      if (simulationActive) return;

      simulationActive = true;
      setStatus('Simulating Drive', true);

      let time = 0;
      const startTime = performance.now();

      // Simulation state
      let speed = 0;
      let rpm = 10;
      let volt = 12;
      let temp = 180;
      let oilPressure = 40;
      let oilLevel = 0.75;

      // Target states (for smooth transitions)
      let targetRpm = 25;
      let accelerating = true;

      function simulate() {
        if (!simulationActive) return;

        time = (performance.now() - startTime) / 1000;

        // RPM: oscillate with occasional revs
        const rpmPhase = Math.sin(time * 0.5) * 0.3 + Math.sin(time * 2.1) * 0.1;

        // Change driving behavior every 3-8 seconds
        if (Math.random() < 0.01) {
          accelerating = !accelerating;
          targetRpm = accelerating ? 35 + Math.random() * 35 : 10 + Math.random() * 20;
        }

        // Smooth RPM approach to target
        rpm += (targetRpm - rpm) * 0.02;
        rpm += rpmPhase * 5;
        rpm = Math.max(8, Math.min(75, rpm));

        // Speed correlates with RPM (simplified gear simulation)
        const targetSpeed = (rpm / 70) * 120 + Math.random() * 5;
        speed += (targetSpeed - speed) * 0.03;
        speed = Math.max(0, Math.min(135, speed));

        // Voltage: slight fluctuation around 13.8-14.2V when running
        volt = 13.8 + Math.sin(time * 0.7) * 0.3 + Math.random() * 0.2;

        // Temperature: slowly rises to ~210, fluctuates
        temp += (210 - temp) * 0.001;
        temp += Math.sin(time * 0.3) * 2;
        temp = Math.max(160, Math.min(230, temp));

        // Oil pressure: varies with RPM
        oilPressure = 20 + (rpm / 80) * 45 + Math.sin(time * 1.5) * 3;
        oilPressure = Math.max(15, Math.min(70, oilPressure));

        // Oil level: stable with tiny fluctuation
        oilLevel = 0.72 + Math.sin(time * 0.1) * 0.03;

        // Update gauges
        gauges.speed.setValue(speed);
        gauges.rpm.setValue(rpm);
        gauges.volt.setValue(volt);
        gauges.temp.setValue(temp);
        gauges.oilPressure.setValue(oilPressure);
        gauges.oilLevel.setValue(oilLevel);

        // Update slider displays
        updateSliderDisplay('speed', speed);
        updateSliderDisplay('rpm', rpm);
        updateSliderDisplay('volt', volt);
        updateSliderDisplay('temp', temp);
        updateSliderDisplay('oilPressure', oilPressure);
        updateSliderDisplay('oilLevel', oilLevel);

        simulationLoop = requestAnimationFrame(simulate);
      }

      simulationLoop = requestAnimationFrame(simulate);
    }

    function stopSimulation() {
      simulationActive = false;
      if (simulationLoop) {
        cancelAnimationFrame(simulationLoop);
        simulationLoop = null;
      }
      setStatus('Stopped', false);
    }

    function updateSliderDisplay(type, value) {
      const control = sliders[type];
      if (control) {
        control.slider.value = value;
        control.value.textContent = control.format(value);
      }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // MODERN GAUGE DEMO
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    const modernGauge = new Gauge(document.getElementById('gauge-modern'), 'modern');
    modernGauge.setValue(95, { immediate: true });
    modernGauge.setRingValue(0, 3500);
    modernGauge.setComplicationValue(0, 0.6);

    // Modern sliders
    const modernSpeedSlider = document.getElementById('modern-speed-slider');
    const modernRpmSlider = document.getElementById('modern-rpm-slider');
    const modernFuelSlider = document.getElementById('modern-fuel-slider');

    modernSpeedSlider.addEventListener('input', () => {
      const v = parseFloat(modernSpeedSlider.value);
      modernGauge.setValue(v);
      document.getElementById('modern-speed-value').textContent = `${Math.round(v)} km/h`;
    });

    modernRpmSlider.addEventListener('input', () => {
      const v = parseFloat(modernRpmSlider.value);
      modernGauge.setRingValue(0, v);
      document.getElementById('modern-rpm-value').textContent = Math.round(v).toString();
    });

    modernFuelSlider.addEventListener('input', () => {
      const v = parseFloat(modernFuelSlider.value);
      modernGauge.setComplicationValue(0, v);
      document.getElementById('modern-fuel-value').textContent = `${Math.round(v * 100)}%`;
    });

    // Modern sweep
    document.getElementById('modern-sweep-btn').addEventListener('click', () => {
      modernGauge.sweep();
    });

    // Modern simulated drive
    let modernDriveActive = false;
    let modernDriveLoop = null;
    document.getElementById('modern-drive-btn').addEventListener('click', () => {
      if (modernDriveActive) {
        modernDriveActive = false;
        if (modernDriveLoop) cancelAnimationFrame(modernDriveLoop);
        return;
      }
      modernDriveActive = true;
      const startTime = performance.now();
      let mSpeed = 95, mRpm = 3500, targetRpm = 3500, accel = true;

      function tick() {
        if (!modernDriveActive) return;
        const t = (performance.now() - startTime) / 1000;

        if (Math.random() < 0.008) { accel = !accel; targetRpm = accel ? 4000 + Math.random() * 3500 : 1500 + Math.random() * 2000; }
        mRpm += (targetRpm - mRpm) * 0.03;
        mRpm += Math.sin(t * 2.5) * 80;
        mRpm = Math.max(800, Math.min(7800, mRpm));

        const targetSpeed = (mRpm / 7500) * 280 + Math.random() * 5;
        mSpeed += (targetSpeed - mSpeed) * 0.02;
        mSpeed = Math.max(0, Math.min(310, mSpeed));

        modernGauge.setValue(mSpeed);
        modernGauge.setRingValue(0, mRpm);

        modernSpeedSlider.value = mSpeed;
        modernRpmSlider.value = mRpm;
        document.getElementById('modern-speed-value').textContent = `${Math.round(mSpeed)} km/h`;
        document.getElementById('modern-rpm-value').textContent = Math.round(mRpm).toString();

        modernDriveLoop = requestAnimationFrame(tick);
      }
      modernDriveLoop = requestAnimationFrame(tick);
    });

    // Redline flash demo â€” push RPM to redline
    document.getElementById('modern-redline-btn').addEventListener('click', () => {
      modernGauge.setRingValue(0, 7500);
      modernRpmSlider.value = 7500;
      document.getElementById('modern-rpm-value').textContent = '7500';
    });
  </script>
</body>
</html>
